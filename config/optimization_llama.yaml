# ============================================================================
# LLAMA OPTIMIZATION CONFIG
# ============================================================================
# Usage:
#   Maximize PI: python src/optimize_intervention.py --config-name optimization_llama
#   Minimize PI: python src/optimize_intervention.py --config-name optimization_llama optimization.direction=minimize
#   Use artifact: python src/optimize_intervention.py --config-name optimization_llama optimization.feature_artifact_name="svm-feature-ranking:latest"

# Model configuration
model:
  name: "meta-llama/Llama-3.1-8B-Instruct"
  wrapper: "llama"

optimization:
  # Target neurons - use feature_artifact_name to load dynamically from SVM artifact
  # Or specify manually below
  feature_artifact_name: null  # e.g., "svm-feature-ranking:latest"
  target_neuron_count: 80  # Number of neurons to select from artifact
  
  target_neurons:
    # --- Group A: Proven Winners (|m| > 0.8) ---
    - "layer_15-neuron_1215"
    - "layer_18-neuron_3629"
    - "layer_16-neuron_2807"
    - "layer_12-neuron_3994"
    - "layer_14-neuron_1829"
    - "layer_15-neuron_2895"
    - "layer_23-neuron_1990"
    - "layer_15-neuron_1659"
    - "layer_13-neuron_588"
    - "layer_16-neuron_122"
    - "layer_15-neuron_2470"
    - "layer_20-neuron_2212"
    - "layer_21-neuron_2212"
    - "layer_13-neuron_39"
    - "layer_14-neuron_3796"
    - "layer_16-neuron_2471"
    
    # --- Group B: The "2058" Axis (Layers 14-30) ---
    - "layer_14-neuron_2058"
    - "layer_15-neuron_2058"
    - "layer_16-neuron_2058"
    - "layer_17-neuron_2058"
    - "layer_18-neuron_2058"
    - "layer_19-neuron_2058"
    - "layer_20-neuron_2058"
    - "layer_21-neuron_2058"
    - "layer_22-neuron_2058"
    - "layer_23-neuron_2058"
    - "layer_24-neuron_2058"
    - "layer_25-neuron_2058"
    - "layer_26-neuron_2058"
    - "layer_27-neuron_2058"
    - "layer_28-neuron_2058"
    - "layer_29-neuron_2058"
    - "layer_30-neuron_2058"
    - "layer_31-neuron_2058"

    # --- Group C: Recovered candidates ---
    - "layer_15-neuron_1829"
    - "layer_14-neuron_805"
    - "layer_15-neuron_1886"
    - "layer_15-neuron_41"
    - "layer_13-neuron_1611"
    - "layer_13-neuron_3564"
    - "layer_18-neuron_2212"
    - "layer_13-neuron_3819"

    # --- Group D: New Candidates ---
    - "layer_16-neuron_2145"
    - "layer_30-neuron_341"
    - "layer_10-neuron_3366"
    - "layer_10-neuron_3086"
    - "layer_13-neuron_977"
    - "layer_20-neuron_3356"
    - "layer_13-neuron_1913"
    - "layer_30-neuron_231"
    - "layer_10-neuron_4018"
    - "layer_21-neuron_3491"
    - "layer_29-neuron_3398"
    - "layer_21-neuron_2706"
    - "layer_15-neuron_940"
    - "layer_22-neuron_1455"
    - "layer_18-neuron_2836"
    - "layer_29-neuron_3685"
    - "layer_28-neuron_792"
    - "layer_17-neuron_77"

  bounds: [-6.0, 6.0]
  sampler: "cmaes"  # "tpe" or "cmaes"
  n_startup_trials: 100
  n_trials: 1000
  
  # Objective: "signed" preserves direction, "absolute" maximizes magnitude
  objective_mode: "signed"
  # Direction: "maximize" (right shift) or "minimize" (left shift)
  direction: "maximize"

  study_name: "llama-pi-optimization"
  storage: null  # Or "sqlite:///runs/optuna_persist/llama_optimization.db"
  load_if_exists: true
  
  fast_mode: false
  fast_n_pairs: 10

likert:
  questions_csv: "likert/questions_anderson.csv"
  language: "pt"
  max_new_tokens: 10
  temperature: 0.0

extraction:
  device: "cuda"

random_state: 42

wandb:
  project: "activation-stance-classifier"
  run_name: null

hydra:
  run:
    dir: runs/${now:%Y-%m-%d}/optimize_llama_${now:%H-%M-%S}
